<!doctype html>
<html>

<head>
    {{unsupportedbrowser}}
    <meta charset="utf-8">
    <title>Mendix</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {{themecss}}
    {{appicons}}
    {{manifest}}
    {{startupimages}}
</head>

<body dir="ltr">
    <noscript>To use this application, please enable JavaScript.</noscript>
    <div id="content"></div>
    <script>
        dojoConfig = {
            isDebug: false,
            useCustomLogger: true,
            async: true,
            baseUrl: "mxclientsystem/dojo/",
            cacheBust: "{{cachebust}}",
            rtlRedirect: "index-rtl.html"
        };
    </script>
    <script>
        if (!document.cookie || !document.cookie.match(/(^|;) *originURI=/gi))
            document.cookie = "originURI=/login.html" + (window.location.protocol === "https:" ? ";SameSite=None;Secure" : "");
    </script>
    <script>
        (async function () {
            window.ReactFamily = await import('http://localhost:5173/hmr.ts');
            // 创建一个对象来保存原始的 window.mx 值
            let originalMx = undefined;

            // 设置新的 window.mx 对象
            Object.defineProperty(window, 'mx', {
                get: function () {
                    return originalMx;
                },
                set: function (newValue) {
                    newValue._startup = newValue.startup;
                    newValue.startup = async () => {
                        await new Promise((resolve, reject) => {
                            require([
                                "dojo/aspect"
                            ], (
                                Aspect
                            ) => {
                                window.Aspect = Aspect;
                                resolve()
                            });
                        })
                    };
                    originalMx = newValue;
                },
                configurable: true
            });

            await loadScript("mxclientsystem/mxui/mxui-dev.js");
            await loadWidget('AddressFinder');
            mx._startup();

            function loadScript(src) {
                return new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = src;
                    script.onload = resolve;
                    script.onerror = reject;
                    document.body.appendChild(script);
                });
            }

            async function loadWidget(widgetName) {
                const modulePath = `http://localhost:5173/src/${widgetName}.tsx`;
                const widget = await import(modulePath);
                const path = `widgets/wengao/${widgetName.toLowerCase()}/${widgetName}`;
                mendix.lang.registerInDojo(path, widget[widgetName]);
            }

        })();
    </script>
    <script type="module">
        import RefreshRuntime from 'http://localhost:5173/@react-refresh';
        RefreshRuntime.injectIntoGlobalHook(window)
        window.$RefreshReg$ = () => { }
        window.$RefreshSig$ = () => (type) => type
        window.__vite_plugin_react_preamble_installed__ = true
    </script>
    <script type="module" src="http://localhost:5173/@vite/client"></script>
</body>

</html>